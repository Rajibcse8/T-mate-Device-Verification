<!DOCTYPE html>
<html>
  <head>
    <title>Requests</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.min.js"></script>
    <title>Requests</title>
  </head>
 
  <div class="container">
    <table class="table" id="mytable">
      
      <thead>
        <tr>
          <th>ID</th>
          <th>Request ID</th>
          <th>Device ID</th>
          <th>Company</th>
          <th>Garden ID</th>
          <th>Requester Name</th>
          <th>Requester Contact</th>
          <th>STATUS</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for request in requests %}
        <tr>
          <td>{{ request[0] }}</td>
          <td>{{ request[1] }}</td>
          <td>{{ request[2] }}</td>
          <td>{{ request[3] }}</td>
          <td>{{ request[4] }}</td>
          <td>{{ request[5] }}</td>
          <td>{{ request[6] }}</td>

          <!-- <td>{{request[7]}}</td> -->
         <td id="{{request[1]}}">
            {{ 'Requested' if request[7]==1 else 'APPROVED' if request[7]==2
            else 'BLOKED' }}
          </td> 

          <td>
            <select class="status">
             

              {% if request[7] == 2 %}
              <option value="{{request[1]}}/1"> Requested</option>
              <option value="{{request[1]}}/2" selected disabled>APPROVED</option>
              <option value="{{request[1]}}/4">Bloked</option>
              {%elif request[7]==1%}
              <option value="{{request[1]}}/1" selected disabled>Requested</option>
              <option value="{{request[1]}}/2">APPROVED</option>
              <option value="{{request[1]}}/4">Bloked</option>
              {%else%}
              <option value="{{request[1]}}/1">Requested</option>
              <option value="{{request[1]}}/2">APPROVED</option>
              <option value="{{request[1]}}/4" selected disabled>Bloked</option>
              {% endif %}
            </select>
          </td>
        </tr>
        
        {% endfor %}
      </tbody>
    </table>
    <!-- <a href="/new_request">New Request</a> -->
    <!-- <nav aria-label="Page navigation example">
      <ul class="pagination">
        <li class="page-item"><a class="page-link" href="#">Previous</a></li>
        <li class="page-item"><a class="page-link" href="#">1</a></li>
        <li class="page-item"><a class="page-link" href="#">2</a></li>
        <li class="page-item"><a class="page-link" href="#">3</a></li>
        <li class="page-item"><a class="page-link" href="#">Next</a></li>
      </ul>
    </nav> -->
      
  </div>
    

    <!--AJAX CODE-->
    <script type="text/javascript">
      // function Myfunction(id, status) {
      //   alert(id);
      // }

      $(".status").change(function () {

        
        var val = $(this).val();
        var status=val.slice(-1);
        var request_id=val.slice(0,val.length-2);
        
        //console.log(   )
         
        
       //  alert(device_id + '  ' + status)
        $.ajax({
          url:"/updatestatus/"+status+"/"+request_id,
          type:"PUT",
          data:"",
          success:function(response){

            $("#"+request_id).text(status ==1 ? 'Requested': status==2 ? 'APPROVED': 'Bloked')            
            
             
            
          },
          error:function(error){
           
          },

        });        
      });

      function LoadData(){

         $.ajax({
          type:'GET',
          url:'/get_data',
          data:{},
          success:function(requests){

            console.log(requests);
            // $("#mytable").html(`    `);
            
          },

         });
        
        
         
       
      }

      // function hello() {
      //   alert("ta");
      // }
    </script>
  </body>
</html>
